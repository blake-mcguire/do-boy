<!doctype html>
<html lang="en">
<head>
    <title>DoBoy Dashboard</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
</head>
<body>
<header>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><img src="index-assets/Untitled design (6).png" style="height: 100px; width: auto;"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<body>
    <!-- TASK ACTIONS SECTION -->
    <div class="container-fluid bg-light rounded" style="padding: 0; background-color: white;">
        <div class="row" style="background-color: #ffffff;">
            <div class="col-lg-3 col-md-3 mt-3 col-sm-3" style="background-color: #ffffff;">
                <div class="actions-container col pb-3 rounded" style="position: sticky; top: 3%; text-align: center; background-color:rgb(39, 39, 39);">
                    <h3 class="mt-2 pt-4 rounded" style="color:rgb(255, 255, 255); align-self: center;">Task Options</h3>
                    <div class="create_new row mt-3 ml-3 py-1 pl-3" style="width: 100%; display:flex; justify-content: center; border-left: 2px solid black">
                        <button class="btn rounded ml-3" data-bs-toggle="modal" data-bs-target="#createTaskModal" style="width: 70%; height: auto; color: white; border: solid white">Create New Task</button>
                    </div>
                    <div class="view_tasks row mt-3 ml-3 py-1 ml-3" style="width: 100%; display:flex; justify-content: center;">
                        <button class="btn rounded" style="width: 70%; color: white; ">~ Filter Tasks ~</button>
                    </div>

                    <!-- priority filter dropdown -->
                    <div class="filter_projects row mt-0 ml-3 py-1 ml-3" style="width: 100%; display:flex; justify-content: center;">
                        <select id="priorityFilter" class="form-select" style="width: 70%">
                            <option value="all">All Priorities</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                    <!-- due date sort dropdown -->
                    <div class="sort_due_date row mt-3 ml-3 py-1 ml-3" style="width: 100%; display:flex; justify-content: center;">
                        <select id="dueDateSort" class="form-select" style="width: 70%">
                            <option value="none">Sort by Due Date</option>
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                    <!-- status sort dropdown -->
                    <div class="sort_status row mt-3 ml-3 py-1 ml-3" style="width: 100%; display:flex; justify-content: center;">
                        <select id="statusSort" class="form-select" style="width: 70%">
                            <option value="none">Sort by Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- TASK DASHBOARD SECTION -->
            <div class="col-md-9 col-lg-9 col-sm-9" style="padding-left: 0;">
                <main class="p-3" style="background-color: #ffffff; padding-left: 0;">
                    <h3 style="text-shadow: 2px 2px 2px #47D5C7; text-align:center; font-size: 3vw; color:#242323">Task Dashboard</h3>
                    
                    <!-- progress Bar -->
                    <div class="container mt-4">
                        <h4>Task Progress</h4>
                        <div class="progress">
                            <div id="taskProgressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </div>

                    <div class="container">
                        <div id="cards-container" class="row">
                            <!-- project cards zone -->
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing Project Details -->
    <div class="modal fade" id="projectDetailModal" tabindex="-1" aria-labelledby="projectDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectDetailModalLabel">Project Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Project details form -->
                    <form id="projectDetailForm">
                        <div class="mb-3">
                            <label for="detailProjectName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="detailProjectName" name="detailProjectName">
                        </div>
                        <div class="mb-3">
                            <label for="detailProjectStatus" class="form-label">Status</label>
                            <select class="form-select" id="detailProjectStatus" name="detailProjectStatus">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="detailDateCreated" class="form-label">Date Created</label>
                            <input type="date" class="form-control" id="detailDateCreated" name="detailDateCreated">
                        </div>
                        <div class="mb-3">
                            <label for="detailDueDate" class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="detailDueDate" name="detailDueDate">
                        </div>
                        <div class="mb-3">
                            <label for="detailProjectPriority" class="form-label">Priority</label>
                            <select class="form-select" id="detailProjectPriority" name="detailProjectPriority">
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form for Creating a New Project -->
    <div class="modal fade" id="createTaskModal" tabindex="-1" aria-labelledby="createTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="createTaskModalLabel">Create New Task</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Form -->
              <form id="createTaskForm">
                <div class="mb-3">
                  <label for="projectName" class="form-label">Name</label>
                  <input type="text" class="form-control" id="projectName" name="projectName">
                </div>
                <div class="mb-3">
                  <label for="projectStatus" class="form-label">Status</label>
                  <select class="form-select" id="projectStatus" name="projectStatus">
                    <option selected>Choose...</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Completed">Completed</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="dateCreated" class="form-label">Date Created</label>
                  <input type="date" class="form-control" id="dateCreated" name="dateCreated">
                </div>
                <div class="mb-3">
                    <label for="dueDate" class="form-label">Due Date</label>
                    <input type="date" class="form-control" id="dueDate" name="dueDate" >
                  </div>
                <div class="mb-3">
                  <label for="projectPriority" class="form-label">Priority</label>
                  <select class="form-select" id="projectPriority" name="projectPriority">
                    <option selected>Choose...</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                  </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
              </form>
            </div>
            
          </div>
        </div>
      </div>

    <footer class="py-3 mt-5 text-dark p-2 rounded-2" style="background: linear-gradient(rgb(255, 255, 255),rgb(41, 197, 197));">
        <div class="row mt-5">
            <div class="col-6 col-md-2 mb-3 ">
                <h5>Section</h5>
                <ul class="nav flex-column">
                    <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">Home</a></li>
                    <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">Features</a></li>
                    <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">Pricing</a></li>
                    <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">FAQs</a></li>
                    <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">About</a></li>
                </ul>
            </div>

            <div class="col-md-5 offset-md-1 mb-3">
                <form>
                    <h5>Subscribe to our newsletter</h5>
                    <p>Monthly digest of what's new and exciting from Do-Boy!</p>
                    <div class="d-flex flex-column flex-sm-row w-100 gap-2">
                        <label for="newsletter1" class="visually-hidden">Email address</label>
                        <input id="newsletter1" type="text" class="form-control" placeholder="Email address">
                        <button class="btn btn-primary" type="button">Subscribe</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="d-flex flex-column flex-sm-row justify-content-between py-2 my-2 border-top">
            <p>Â© 2024 Do-Boy, Inc. All rights reserved.</p>
            <ul class="list-unstyled d-flex">
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"></use></svg></a></li>
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"></use></svg></a></li>
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"></use></svg></a></li>
            </ul>
        </div>
    </footer>

    <script>
        // Project data initialized as empty list
        let projects = [];

        // Function to update the progress bar
        function updateProgressBar() {
            const activeTasks = projects.filter(project => project.status.toLowerCase() === 'active').length;
            const completedTasks = projects.filter(project => project.status.toLowerCase() === 'completed').length;
            const totalTasks = activeTasks + completedTasks;
            
            const progressBar = document.getElementById('taskProgressBar');
            // if tasks are more than 0
            //set the progress percent equal to amount of tasks that are completed/ totaltasks times 100 and set width to the percent
            if (totalTasks > 0) {
                const progressPercentage = (completedTasks / totalTasks) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                progressBar.setAttribute('aria-valuenow', progressPercentage);
                progressBar.innerText = `${Math.round(progressPercentage)}% Completed`;

                // color based on progress percentage
                progressBar.classList.remove('bg-success', 'bg-warning', 'bg-danger');
                if (progressPercentage >= 75) {
                    progressBar.classList.add('bg-success');
                } else if (progressPercentage >= 50) {
                    progressBar.classList.add('bg-warning');
                } else {
                    progressBar.classList.add('bg-danger');
                }
            } else {
                progressBar.style.width = '0%';
                progressBar.setAttribute('aria-valuenow', 0);
                progressBar.innerText = '0% Completed';
                progressBar.classList.remove('bg-success', 'bg-warning', 'bg-danger');
            }
        }

        // Handle form submission to create a new task
        document.getElementById('createTaskForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const taskData = {
                name: formData.get('projectName'), //form name
                status: formData.get('projectStatus'), // status input
                dateCreated: formData.get('dateCreated'), //date created input
                dueDate: formData.get('dueDate'), //duedate input
                priority: formData.get('projectPriority') //priority level input
            };

            projects.push(taskData); //pushing task data into the projects list
            renderProjects(projects); //render projects
            updateProgressBar(); // Update progress bar
            event.target.reset();
            document.getElementById('dateCreated').value = new Date().toISOString().split('T')[0];
            document.getElementById('dueDate').value = '';
            bootstrap.Modal.getInstance(document.getElementById('createTaskModal')).hide();
        });

        // function to create the task card with an html insert using the task inputs as variable inputs
        function createTaskCard(taskData) {
            const cardContainer = document.getElementById('cards-container'); // setting cardcontainer to be equal to the cards-container element
            const newCard = document.createElement('div');
            newCard.className = 'col-sm-6 py-4 p-4 mt-4 mb-4'; // template class name
            newCard.innerHTML = `          
                <div class="card" style="box-shadow: 0px 0px 10px;">
                    <div class="card-body">
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="exampleCheck1">
                            <label class="form-check-label" for="exampleCheck1"><h5>${taskData.name}</h5></label>
                        </div>
                        <p class="card-text text-primary">Status : ${taskData.status}</p>
                        <p class="card-text text-${taskData.priority.toLowerCase()}">Priority : ${taskData.priority}</p>
                        <button type="button" class="btn btn-primary view-details-btn" data-bs-toggle="modal" data-bs-target="#projectDetailModal">View Project Details</button>
                    </div>
                </div>
            `; //template with inserted variables
            cardContainer.prepend(newCard); //add the new card to the very top

            // event listener for the new "View Details" button
            newCard.querySelector('.view-details-btn').addEventListener('click', function() {
                openProjectDetailModal(taskData, newCard);
            });
        }

        // for opening the project details modal 
        function openProjectDetailModal(taskData, cardElement) {
            document.getElementById('detailProjectName').value = taskData.name;
            document.getElementById('detailProjectStatus').value = taskData.status;
            document.getElementById('detailDateCreated').value = taskData.dateCreated;
            document.getElementById('detailDueDate').value = taskData.dueDate;
            document.getElementById('detailProjectPriority').value = taskData.priority;
            //updating any new changes made in the form modal
            document.getElementById('projectDetailForm').onsubmit = function(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                taskData.name = formData.get('detailProjectName');
                taskData.status = formData.get('detailProjectStatus');
                taskData.dateCreated = formData.get('detailDateCreated');
                taskData.dueDate = formData.get('detailDueDate');
                taskData.priority = formData.get('detailProjectPriority');
                // mapping the inputs to the card details
                updateCardDetails(cardElement, taskData);
                bootstrap.Modal.getInstance(document.getElementById('projectDetailModal')).hide();
                renderProjects(projects); 
                updateProgressBar(); // update progress bar
            };
        }

        //updating the card display to reflect changes made to the modal
        function updateCardDetails(cardElement, taskData) {
            cardElement.querySelector('h5').innerText = taskData.name;
            cardElement.querySelector('.text-primary').innerText = `Status : ${taskData.status}`;
            cardElement.querySelector('.card-text:nth-child(3)').innerText = `Priority : ${taskData.priority}`;
            cardElement.querySelector('.card-text:nth-child(3)').className = `card-text text-${taskData.priority.toLowerCase()}`;
        }

        //render projects
        function renderProjects(filteredProjects) {
            const projectContainer = document.getElementById('cards-container');
            projectContainer.innerHTML = '';
            filteredProjects.forEach(createTaskCard);
        }

        //filter projects
        function filterProjects() {
            const selectedPriority = document.getElementById('priorityFilter').value;
            const selectedDueDateSort = document.getElementById('dueDateSort').value;
            const selectedStatusSort = document.getElementById('statusSort').value;
            
            let filteredProjects = selectedPriority === 'all' 
                ? projects 
                : projects.filter(project => project.priority.toLowerCase() === selectedPriority);
            // 
            if (selectedDueDateSort !== 'none') {
                filteredProjects.sort((a, b) => {
                    const dateA = new Date(a.dueDate);
                    const dateB = new Date(b.dueDate);
                    return selectedDueDateSort === 'asc' ? dateA - dateB : dateB - dateA;
                });
            }

            if (selectedStatusSort !== 'none') {
                filteredProjects = filteredProjects.filter(project => project.status.toLowerCase() === selectedStatusSort);
            }

            renderProjects(filteredProjects);
            updateProgressBar(); // progress bar is updated after filtering
        }

        // event listener to the filter and sort dropdowns
        document.getElementById('priorityFilter').addEventListener('change', filterProjects);
        document.getElementById('dueDateSort').addEventListener('change', filterProjects);
        document.getElementById('statusSort').addEventListener('change', filterProjects);

        
        renderProjects(projects);
        updateProgressBar(); // 1st progress bar update
    </script>

    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>